#!/usr/bin/env python3


__author__ = "Jake Miller"
__date__ = "5/5/2021"
__version__ = "0.01"
__description__ = """A script analyze json file of CVE data (https://nvd.nist.gov/vuln/data-feeds)"""


import time
import sys
import json
import os
import argparse
from collections import Counter
import pandas as pd


def cwe_to_pillar():
    d = {'CWE-5': '693', 'CWE-6': '693', 'CWE-7': '703', 'CWE-8': '664', 'CWE-9': '284', 'CWE-11': '710', 'CWE-12': '703', 'CWE-13': '284', 'CWE-14': '435', 'CWE-15': '664', 'CWE-20': '707', 'CWE-22': '664', 'CWE-23': '664', 'CWE-24': '664', 'CWE-25': '664', 'CWE-26': '664', 'CWE-27': '664', 'CWE-28': '664', 'CWE-29': '664', 'CWE-30': '664', 'CWE-31': '664', 'CWE-32': '664', 'CWE-33': '664', 'CWE-34': '664', 'CWE-35': '664', 'CWE-36': '664', 'CWE-37': '664', 'CWE-38': '664', 'CWE-39': '664', 'CWE-40': '664', 'CWE-41': '664', 'CWE-42': '664', 'CWE-43': '664', 'CWE-44': '664', 'CWE-45': '664', 'CWE-46': '664', 'CWE-47': '664', 'CWE-48': '664', 'CWE-49': '664', 'CWE-50': '664', 'CWE-51': '664', 'CWE-52': '664', 'CWE-53': '664', 'CWE-54': '664', 'CWE-55': '664', 'CWE-56': '664', 'CWE-57': '664', 'CWE-58': '664', 'CWE-59': '664', 'CWE-61': '664', 'CWE-62': '664', 'CWE-64': '664', 'CWE-65': '664', 'CWE-66': '664', 'CWE-67': '664', 'CWE-69': '664', 'CWE-72': '664', 'CWE-73': '664', 'CWE-74': '707', 'CWE-75': '707', 'CWE-76': '707', 'CWE-77': '707', 'CWE-78': '707', 'CWE-79': '707', 'CWE-80': '707', 'CWE-81': '707', 'CWE-82': '707', 'CWE-83': '707', 'CWE-84': '707', 'CWE-85': '707', 'CWE-86': '707', 'CWE-87': '707', 'CWE-88': '707', 'CWE-89': '707', 'CWE-90': '707', 'CWE-91': '707', 'CWE-93': '707', 'CWE-94': '707', 'CWE-95': '707', 'CWE-96': '707', 'CWE-97': '707', 'CWE-98': '664', 'CWE-99': '707', 'CWE-102': '707', 'CWE-103': '710', 'CWE-104': '710', 'CWE-105': '707', 'CWE-106': '707', 'CWE-107': '710', 'CWE-108': '707', 'CWE-109': '707', 'CWE-110': '710', 'CWE-111': '710', 'CWE-112': '707', 'CWE-113': '707', 'CWE-114': '664', 'CWE-115': '435', 'CWE-116': '707', 'CWE-117': '707', 'CWE-118': '664', 'CWE-119': '664', 'CWE-120': '664', 'CWE-121': '664', 'CWE-122': '664', 'CWE-123': '664', 'CWE-124': '664', 'CWE-125': '664', 'CWE-126': '664', 'CWE-127': '664', 'CWE-128': '682', 'CWE-129': '707', 'CWE-130': '703', 'CWE-131': '682', 'CWE-134': '664', 'CWE-135': '682', 'CWE-138': '707', 'CWE-140': '707', 'CWE-141': '707', 'CWE-142': '707', 'CWE-143': '707', 'CWE-144': '707', 'CWE-145': '707', 'CWE-146': '707', 'CWE-147': '707', 'CWE-148': '707', 'CWE-149': '707', 'CWE-150': '707', 'CWE-151': '707', 'CWE-152': '707', 'CWE-153': '707', 'CWE-154': '707', 'CWE-155': '707', 'CWE-156': '707', 'CWE-157': '707', 'CWE-158': '707', 'CWE-159': '707', 'CWE-160': '707', 'CWE-161': '707', 'CWE-162': '707', 'CWE-163': '707', 'CWE-164': '707', 'CWE-165': '707', 'CWE-166': '707', 'CWE-167': '707', 'CWE-168': '707', 'CWE-170': '707', 'CWE-172': '707', 'CWE-173': '707', 'CWE-174': '707', 'CWE-175': '707', 'CWE-176': '707', 'CWE-177': '707', 'CWE-178': '664', 'CWE-179': '707', 'CWE-180': '707', 'CWE-181': '707', 'CWE-182': '693', 'CWE-183': '697', 'CWE-184': '693', 'CWE-185': '697', 'CWE-186': '697', 'CWE-187': '697', 'CWE-188': '710', 'CWE-190': '682', 'CWE-191': '682', 'CWE-192': '664', 'CWE-193': '682', 'CWE-194': '664', 'CWE-195': '664', 'CWE-196': '664', 'CWE-197': '664', 'CWE-198': '710', 'CWE-200': '664', 'CWE-201': '664', 'CWE-202': '284', 'CWE-203': '664', 'CWE-204': '664', 'CWE-205': '664', 'CWE-206': '664', 'CWE-207': '664', 'CWE-208': '664', 'CWE-209': '664', 'CWE-210': '664', 'CWE-211': '664', 'CWE-212': '664', 'CWE-213': '664', 'CWE-214': '664', 'CWE-215': '664', 'CWE-219': '664', 'CWE-220': '664', 'CWE-221': '664', 'CWE-222': '664', 'CWE-223': '664', 'CWE-224': '664', 'CWE-226': '664', 'CWE-228': '703', 'CWE-229': '703', 'CWE-230': '703', 'CWE-231': '703', 'CWE-232': '703', 'CWE-233': '703', 'CWE-234': '703', 'CWE-235': '703', 'CWE-236': '703', 'CWE-237': '703', 'CWE-238': '703', 'CWE-239': '703', 'CWE-240': '703', 'CWE-241': '703', 'CWE-242': '710', 'CWE-243': '710', 'CWE-244': '664', 'CWE-245': '710', 'CWE-246': '710', 'CWE-248': '691', 'CWE-250': '710', 'CWE-252': '703', 'CWE-253': '710', 'CWE-256': '284', 'CWE-257': '284', 'CWE-258': '284', 'CWE-259': '284', 'CWE-260': '284', 'CWE-261': '284', 'CWE-262': '284', 'CWE-263': '284', 'CWE-266': '284', 'CWE-267': '284', 'CWE-268': '284', 'CWE-269': '284', 'CWE-270': '284', 'CWE-271': '284', 'CWE-272': '284', 'CWE-273': '703', 'CWE-274': '703', 'CWE-276': '284', 'CWE-277': '284', 'CWE-278': '284', 'CWE-279': '284', 'CWE-280': '703', 'CWE-281': '284', 'CWE-282': '284', 'CWE-283': '284', 'CWE-284': '284', 'CWE-285': '284', 'CWE-286': '284', 'CWE-287': '284', 'CWE-288': '284', 'CWE-289': '284', 'CWE-290': '284', 'CWE-291': '284', 'CWE-293': '284', 'CWE-294': '284', 'CWE-295': '284', 'CWE-296': '284', 'CWE-297': '284', 'CWE-298': '284', 'CWE-299': '284', 'CWE-300': '284', 'CWE-301': '284', 'CWE-302': '284', 'CWE-303': '284', 'CWE-304': '284', 'CWE-305': '284', 'CWE-306': '284', 'CWE-307': '284', 'CWE-308': '284', 'CWE-309': '284', 'CWE-311': '693', 'CWE-312': '693', 'CWE-313': '693', 'CWE-314': '693', 'CWE-315': '693', 'CWE-316': '693', 'CWE-317': '693', 'CWE-318': '693', 'CWE-319': '693', 'CWE-321': '284', 'CWE-322': '284', 'CWE-323': '693', 'CWE-324': '664', 'CWE-325': '710', 'CWE-326': '693', 'CWE-327': '693', 'CWE-328': '693', 'CWE-329': '693', 'CWE-330': '693', 'CWE-331': '693', 'CWE-332': '693', 'CWE-333': '693', 'CWE-334': '693', 'CWE-335': '693', 'CWE-336': '693', 'CWE-337': '693', 'CWE-338': '693', 'CWE-339': '693', 'CWE-340': '693', 'CWE-341': '693', 'CWE-342': '693', 'CWE-343': '693', 'CWE-344': '693', 'CWE-345': '693', 'CWE-346': '693', 'CWE-347': '693', 'CWE-348': '693', 'CWE-349': '693', 'CWE-350': '284', 'CWE-351': '693', 'CWE-352': '693', 'CWE-353': '693', 'CWE-354': '693', 'CWE-356': '664', 'CWE-357': '693', 'CWE-358': '710', 'CWE-359': '664', 'CWE-360': '693', 'CWE-362': '691', 'CWE-363': '691', 'CWE-364': '691', 'CWE-365': '691', 'CWE-366': '691', 'CWE-367': '691', 'CWE-368': '691', 'CWE-369': '682', 'CWE-370': '284', 'CWE-372': '664', 'CWE-374': '664', 'CWE-375': '664', 'CWE-377': '664', 'CWE-378': '664', 'CWE-379': '664', 'CWE-382': '691', 'CWE-383': '710', 'CWE-384': '664', 'CWE-385': '664', 'CWE-386': '664', 'CWE-390': '703', 'CWE-391': '703', 'CWE-392': '710', 'CWE-393': '710', 'CWE-394': '703', 'CWE-395': '691', 'CWE-396': '691', 'CWE-397': '691', 'CWE-400': '664', 'CWE-401': '664', 'CWE-402': '664', 'CWE-403': '664', 'CWE-404': '664', 'CWE-405': '664', 'CWE-406': '664', 'CWE-407': '664', 'CWE-408': '664', 'CWE-409': '664', 'CWE-410': '664', 'CWE-412': '664', 'CWE-413': '664', 'CWE-414': '664', 'CWE-415': '664', 'CWE-416': '664', 'CWE-419': '284', 'CWE-420': '284', 'CWE-421': '284', 'CWE-422': '284', 'CWE-424': '693', 'CWE-425': '284', 'CWE-426': '664', 'CWE-427': '664', 'CWE-428': '664', 'CWE-430': '691', 'CWE-431': '691', 'CWE-432': '691', 'CWE-433': '664', 'CWE-434': '664', 'CWE-435': '435', 'CWE-436': '435', 'CWE-437': '435', 'CWE-439': '435', 'CWE-440': '710', 'CWE-441': '664', 'CWE-444': '435', 'CWE-446': '710', 'CWE-447': '710', 'CWE-448': '710', 'CWE-449': '710', 'CWE-450': '693', 'CWE-451': '710', 'CWE-453': '664', 'CWE-454': '664', 'CWE-455': '664', 'CWE-456': '664', 'CWE-457': '664', 'CWE-459': '664', 'CWE-460': '664', 'CWE-462': '707', 'CWE-463': '707', 'CWE-464': '707', 'CWE-466': '664', 'CWE-467': '682', 'CWE-468': '682', 'CWE-469': '682', 'CWE-470': '664', 'CWE-471': '664', 'CWE-472': '664', 'CWE-473': '664', 'CWE-474': '710', 'CWE-475': '710', 'CWE-476': '710', 'CWE-477': '710', 'CWE-478': '697', 'CWE-479': '691', 'CWE-480': '691', 'CWE-481': '691', 'CWE-482': '691', 'CWE-483': '691', 'CWE-484': '710', 'CWE-486': '697', 'CWE-487': '664', 'CWE-488': '664', 'CWE-489': '710', 'CWE-491': '664', 'CWE-492': '664', 'CWE-493': '664', 'CWE-494': '693', 'CWE-495': '664', 'CWE-496': '664', 'CWE-497': '664', 'CWE-498': '664', 'CWE-499': '664', 'CWE-500': '664', 'CWE-501': '664', 'CWE-502': '664', 'CWE-506': '710', 'CWE-507': '710', 'CWE-508': '710', 'CWE-509': '710', 'CWE-510': '710', 'CWE-511': '710', 'CWE-512': '710', 'CWE-514': '664', 'CWE-515': '664', 'CWE-520': '284', 'CWE-521': '284', 'CWE-522': '284', 'CWE-523': '284', 'CWE-524': '664', 'CWE-525': '664', 'CWE-526': '664', 'CWE-527': '664', 'CWE-528': '664', 'CWE-529': '664', 'CWE-530': '664', 'CWE-531': '664', 'CWE-532': '664', 'CWE-535': '664', 'CWE-536': '664', 'CWE-537': '664', 'CWE-538': '664', 'CWE-539': '664', 'CWE-540': '664', 'CWE-541': '664', 'CWE-543': '664', 'CWE-544': '703', 'CWE-546': '710', 'CWE-547': '710', 'CWE-548': '664', 'CWE-549': '284', 'CWE-550': '664', 'CWE-551': '284', 'CWE-552': '664', 'CWE-553': '664', 'CWE-554': '707', 'CWE-555': '284', 'CWE-556': '284', 'CWE-558': '664', 'CWE-560': '710', 'CWE-561': '710', 'CWE-562': '710', 'CWE-563': '710', 'CWE-564': '707', 'CWE-565': '664', 'CWE-566': '284', 'CWE-567': '664', 'CWE-568': '710', 'CWE-570': '710', 'CWE-571': '710', 'CWE-572': '664', 'CWE-573': '710', 'CWE-574': '710', 'CWE-575': '710', 'CWE-576': '710', 'CWE-577': '710', 'CWE-578': '710', 'CWE-579': '710', 'CWE-580': '664', 'CWE-581': '710', 'CWE-582': '664', 'CWE-583': '664', 'CWE-584': '691', 'CWE-585': '710', 'CWE-586': '710', 'CWE-587': '693', 'CWE-588': '664', 'CWE-589': '710', 'CWE-590': '664', 'CWE-591': '664', 'CWE-593': '664', 'CWE-594': '710', 'CWE-595': '697', 'CWE-597': '697', 'CWE-598': '664', 'CWE-599': '284', 'CWE-600': '691', 'CWE-601': '664', 'CWE-602': '664', 'CWE-603': '664', 'CWE-605': '710', 'CWE-606': '707', 'CWE-607': '664', 'CWE-608': '664', 'CWE-609': '664', 'CWE-610': '664', 'CWE-611': '664', 'CWE-612': '284', 'CWE-613': '664', 'CWE-614': '693', 'CWE-615': '664', 'CWE-616': '693', 'CWE-617': '691', 'CWE-618': '664', 'CWE-619': '664', 'CWE-620': '284', 'CWE-621': '707', 'CWE-622': '707', 'CWE-623': '284', 'CWE-624': '707', 'CWE-625': '697', 'CWE-626': '707', 'CWE-627': '707', 'CWE-628': '710', 'CWE-636': '710', 'CWE-637': '710', 'CWE-638': '710', 'CWE-639': '284', 'CWE-640': '284', 'CWE-641': '707', 'CWE-642': '664', 'CWE-643': '707', 'CWE-644': '707', 'CWE-645': '284', 'CWE-646': '693', 'CWE-647': '284', 'CWE-648': '284', 'CWE-649': '693', 'CWE-650': '435', 'CWE-651': '664', 'CWE-652': '707', 'CWE-653': '710', 'CWE-654': '710', 'CWE-655': '710', 'CWE-656': '710', 'CWE-657': '710', 'CWE-662': '664', 'CWE-663': '664', 'CWE-664': '664', 'CWE-665': '664', 'CWE-666': '664', 'CWE-667': '664', 'CWE-668': '664', 'CWE-669': '664', 'CWE-670': '691', 'CWE-671': '710', 'CWE-672': '664', 'CWE-673': '664', 'CWE-674': '691', 'CWE-675': '710', 'CWE-676': '710', 'CWE-680': '664', 'CWE-681': '664', 'CWE-682': '682', 'CWE-683': '710', 'CWE-684': '710', 'CWE-685': '710', 'CWE-686': '710', 'CWE-687': '710', 'CWE-688': '710', 'CWE-689': '691', 'CWE-690': '710', 'CWE-691': '691', 'CWE-692': '707', 'CWE-693': '693', 'CWE-694': '707', 'CWE-695': '710', 'CWE-696': '691', 'CWE-697': '697', 'CWE-698': '691', 'CWE-703': '703', 'CWE-704': '664', 'CWE-705': '691', 'CWE-706': '664', 'CWE-707': '707', 'CWE-708': '284', 'CWE-710': '710', 'CWE-732': '284', 'CWE-733': '435', 'CWE-749': '664', 'CWE-754': '703', 'CWE-755': '703', 'CWE-756': '703', 'CWE-757': '693', 'CWE-758': '710', 'CWE-759': '693', 'CWE-760': '693', 'CWE-761': '664', 'CWE-762': '664', 'CWE-763': '664', 'CWE-764': '664', 'CWE-765': '664', 'CWE-766': '710', 'CWE-767': '664', 'CWE-768': '691', 'CWE-770': '664', 'CWE-771': '664', 'CWE-772': '664', 'CWE-773': '664', 'CWE-774': '664', 'CWE-775': '664', 'CWE-776': '691', 'CWE-777': '697', 'CWE-778': '664', 'CWE-779': '664', 'CWE-780': '693', 'CWE-781': '707', 'CWE-782': '664', 'CWE-783': '691', 'CWE-784': '693', 'CWE-785': '710', 'CWE-786': '664', 'CWE-787': '664', 'CWE-788': '664', 'CWE-789': '664', 'CWE-790': '707', 'CWE-791': '707', 'CWE-792': '707', 'CWE-793': '707', 'CWE-794': '707', 'CWE-795': '707', 'CWE-796': '707', 'CWE-797': '707', 'CWE-798': '284', 'CWE-799': '691', 'CWE-804': '284', 'CWE-805': '664', 'CWE-806': '664', 'CWE-807': '693', 'CWE-820': '664', 'CWE-821': '664', 'CWE-822': '664', 'CWE-823': '664', 'CWE-824': '664', 'CWE-825': '664', 'CWE-826': '664', 'CWE-827': '664', 'CWE-828': '691', 'CWE-829': '664', 'CWE-830': '664', 'CWE-831': '691', 'CWE-832': '664', 'CWE-833': '664', 'CWE-834': '691', 'CWE-835': '691', 'CWE-836': '284', 'CWE-837': '691', 'CWE-838': '707', 'CWE-839': '697', 'CWE-841': '691', 'CWE-842': '284', 'CWE-843': '664', 'CWE-862': '284', 'CWE-863': '284', 'CWE-908': '664', 'CWE-909': '664', 'CWE-910': '664', 'CWE-911': '664', 'CWE-912': '710', 'CWE-913': '664', 'CWE-914': '707', 'CWE-915': '664', 'CWE-916': '693', 'CWE-917': '707', 'CWE-918': '664', 'CWE-920': '664', 'CWE-921': '664', 'CWE-922': '664', 'CWE-923': '284', 'CWE-924': '693', 'CWE-925': '284', 'CWE-926': '284', 'CWE-927': '284', 'CWE-939': '284', 'CWE-940': '284', 'CWE-941': '284', 'CWE-942': '284', 'CWE-943': '707', 'CWE-1004': '284', 'CWE-1007': '710', 'CWE-1021': '664', 'CWE-1022': '284', 'CWE-1023': '697', 'CWE-1024': '697', 'CWE-1025': '697', 'CWE-1037': '435', 'CWE-1038': '435', 'CWE-1039': '693', 'CWE-1041': '710', 'CWE-1042': '664', 'CWE-1043': '710', 'CWE-1044': '710', 'CWE-1045': '710', 'CWE-1046': '664', 'CWE-1047': '710', 'CWE-1048': '710', 'CWE-1049': '664', 'CWE-1050': '664', 'CWE-1051': '664', 'CWE-1052': '664', 'CWE-1053': '710', 'CWE-1054': '710', 'CWE-1055': '710', 'CWE-1056': '710', 'CWE-1057': '710', 'CWE-1058': '664', 'CWE-1059': '710', 'CWE-1060': '710', 'CWE-1061': '710', 'CWE-1062': '710', 'CWE-1063': '664', 'CWE-1064': '710', 'CWE-1065': '710', 'CWE-1066': '710', 'CWE-1067': '664', 'CWE-1068': '710', 'CWE-1069': '710', 'CWE-1070': '710', 'CWE-1071': '710', 'CWE-1072': '664', 'CWE-1073': '664', 'CWE-1074': '710', 'CWE-1075': '710', 'CWE-1076': '710', 'CWE-1077': '697', 'CWE-1078': '710', 'CWE-1079': '710', 'CWE-1080': '710', 'CWE-1082': '710', 'CWE-1083': '710', 'CWE-1084': '664', 'CWE-1085': '710', 'CWE-1086': '710', 'CWE-1087': '710', 'CWE-1088': '664', 'CWE-1089': '664', 'CWE-1090': '710', 'CWE-1091': '664', 'CWE-1092': '710', 'CWE-1093': '710', 'CWE-1094': '664', 'CWE-1095': '710', 'CWE-1096': '664', 'CWE-1097': '710', 'CWE-1098': '710', 'CWE-1099': '710', 'CWE-1100': '710', 'CWE-1101': '710', 'CWE-1102': '710', 'CWE-1103': '710', 'CWE-1104': '710', 'CWE-1105': '710', 'CWE-1106': '710', 'CWE-1107': '710', 'CWE-1108': '710', 'CWE-1109': '710', 'CWE-1110': '710', 'CWE-1111': '710', 'CWE-1112': '710', 'CWE-1113': '710', 'CWE-1114': '710', 'CWE-1115': '710', 'CWE-1116': '710', 'CWE-1117': '710', 'CWE-1118': '710', 'CWE-1119': '710', 'CWE-1120': '710', 'CWE-1121': '710', 'CWE-1122': '710', 'CWE-1123': '710', 'CWE-1124': '710', 'CWE-1125': '710', 'CWE-1126': '710', 'CWE-1127': '710', 'CWE-1164': '710', 'CWE-1173': '707', 'CWE-1174': '707', 'CWE-1176': '664', 'CWE-1177': '710', 'CWE-1188': '664', 'CWE-1189': '664', 'CWE-1190': '691', 'CWE-1191': '284', 'CWE-1192': '710', 'CWE-1193': '691', 'CWE-1204': '693', 'CWE-1209': '710', 'CWE-1220': '284', 'CWE-1221': '664', 'CWE-1222': '284', 'CWE-1223': '691', 'CWE-1224': '284', 'CWE-1229': '664', 'CWE-1230': '284', 'CWE-1231': '284', 'CWE-1232': '664', 'CWE-1233': '664', 'CWE-1234': '664', 'CWE-1235': '664', 'CWE-1236': '707', 'CWE-1239': '664', 'CWE-1240': '693', 'CWE-1241': '693', 'CWE-1242': '284', 'CWE-1243': '284', 'CWE-1244': '284', 'CWE-1245': '710', 'CWE-1246': '664', 'CWE-1247': '703', 'CWE-1248': '693', 'CWE-1249': '664', 'CWE-1250': '664', 'CWE-1251': '664', 'CWE-1252': '284', 'CWE-1253': '693', 'CWE-1254': '664', 'CWE-1255': '664', 'CWE-1256': '284', 'CWE-1257': '284', 'CWE-1258': '664', 'CWE-1259': '284', 'CWE-1260': '284', 'CWE-1261': '703', 'CWE-1262': '284', 'CWE-1263': '284', 'CWE-1264': '664', 'CWE-1265': '691', 'CWE-1266': '664', 'CWE-1267': '284', 'CWE-1268': '284', 'CWE-1269': '693', 'CWE-1270': '284', 'CWE-1271': '664', 'CWE-1272': '664', 'CWE-1273': '664', 'CWE-1274': '284', 'CWE-1275': '284', 'CWE-1276': '284', 'CWE-1277': '664', 'CWE-1278': '693', 'CWE-1279': '664', 'CWE-1280': '691', 'CWE-1281': '691', 'CWE-1282': '664', 'CWE-1283': '284', 'CWE-1284': '707', 'CWE-1285': '707', 'CWE-1286': '707', 'CWE-1287': '707', 'CWE-1288': '707', 'CWE-1289': '707', 'CWE-1290': '284', 'CWE-1291': '693', 'CWE-1292': '284', 'CWE-1293': '693', 'CWE-1294': '284', 'CWE-1295': '664', 'CWE-1296': '284', 'CWE-1297': '284', 'CWE-1298': '691', 'CWE-1299': '284', 'CWE-1300': '664', 'CWE-1301': '664', 'CWE-1302': '284', 'CWE-1303': '664', 'CWE-1304': '284', 'CWE-1310': '664', 'CWE-1311': '284', 'CWE-1312': '284', 'CWE-1313': '284', 'CWE-1314': '284', 'CWE-1315': '284', 'CWE-1316': '284', 'CWE-1317': '284', 'CWE-1318': '693', 'CWE-1319': '693', 'CWE-1320': '284', 'CWE-1321': '664', 'CWE-1322': '691', 'CWE-1323': '284', 'CWE-1324': '284', 'CWE-1325': '664', 'CWE-1326': '693', 'CWE-1327': '664', 'CWE-1328': '284', 'CWE-1329': '664', 'CWE-1330': '664', 'CWE-1331': '710', 'CWE-1332': '693', 'CWE-1333': '664', 'CWE-1334': '284', 'CWE-1335': '682', 'CWE-1336': '707', 'CWE-1338': '693', 'CWE-1339': '682', 'CWE-1351': '703'}
    return d

def get_data_lists_from_dict(d):
    """Gets data from dict and returns list of lists"""
    
    # Main list that gets populated with lists and returned
    data = []

    items = d.get('CVE_Items')
    
    for item in items:
        # Everything will be added to the data list eventually.
        # This will be a row of data in that list
        row = []

        try:
            desc = item.get('cve').get('description').get('description_data')[0].get('value')

            # If the description values starts with ** REJECT, that means
            # the CVE was probably not correct and we should skip this item
            if desc.startswith('** REJECT **'):
                continue
        except Exception as e:
            desc = ''
        cve_id = item.get('cve').get('CVE_data_meta').get('ID')
        try:
            cwe_id = item.get('cve').get('problemtype').get('problemtype_data')[0].get('description')[0].get('value')
            if cwe_id == '':
                cwe_id = 'CWE-Uncategorized'
            if cwe_id.startswith('NVD-CWE'):
                cwe_id = 'CWE-Uncategorized'
        except Exception as e:
            cwe_id = ''
        try:
            cvss3_base_severity = item.get('impact').get('baseMetricV3').get('cvssV3').get('baseSeverity')
        except Exception as e:
            cvss3_base_severity = ''
        try:
            cvss3_base_score = item.get('impact').get('baseMetricV3').get('cvssV3').get('baseScore')
        except Exception as e:
            cvss3_base_score = ''
        try:
            cvss2_base_severity = item.get('impact').get('baseMetricV2').get('severity')
        except Exception as e:
            cvss2_base_severity = ''
        try:
            cvss2_base_score = item.get('impact').get('baseMetricV2').get('cvssV2').get('baseScore')
        except Exception as e:
            cvss2_base_score = ''

        row.extend((
            cve_id,
            cwe_id,
            desc,
            cvss3_base_severity,
            cvss3_base_score,
            cvss2_base_severity,
            cvss2_base_score
        ))
        data.append(row)

    return data


def read_json_to_dict(fn):
    """Read the JSON file and return as a dict"""
    with open(fn, encoding='utf-8') as fh:
        return json.load(fh)


def print_risks_by_rating(df):
    """Prints risks by each rating."""
    risk_ratings = Counter(list(df["CVSSv3 Base Severity"]))
    print(f"[+] CVSSv3 Base Severity Risk Ratings")
    print(f"Critical: {risk_ratings.get('CRITICAL')}")
    print(f"High: {risk_ratings.get('HIGH')}")
    print(f"Medium: {risk_ratings.get('MEDIUM')}")
    print(f"Low: {risk_ratings.get('LOW')}")
    print(f"Informational: {risk_ratings.get('')}")


def get_cwe_risk_info(df, cwe_id):
    """Prints risk info in a dataframe for a specific 
    CWE ID.
    """
    print(f"[+] Risk data for CWE {cwe_id}")
    #breakpoint()
    print(f"Pillar CWE ID: {df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CWE Pillar ID']}")
    print(f'Total instances of CWE {cwe_id}: ' + str(len(df.loc[df['CWE ID'] == f'CWE-{cwe_id}'])))
    print()
    print('CVSSv3')
    print('Risk ratings: ' + ' '.join(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv3 Base Severity'].unique()))
    print('Mean score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv3 Base Score']).mean()))
    print('Median score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv3 Base Score']).median()))
    print('Min score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv3 Base Score']).min()))
    print('Max score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv3 Base Score']).max()))
    print()
    print('CVSSv2')
    print('Risk ratings: ' + ' '.join(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv2 Base Severity'].unique()))
    print('Mean score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv2 Base Score']).mean()))
    print('Median score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv2 Base Score']).median()))
    print('Min score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv2 Base Score']).min()))
    print('Max score: ' + str(pd.to_numeric(df.loc[df['CWE ID'] == f'CWE-{cwe_id}']['CVSSv2 Base Score']).max()))
    

def get_most_and_least_common_cwe(df):
    """Gets the most and least common CWEs from the data frame."""
    cwes = Counter(list(df.loc[df['CWE ID'] != 'CWE-Uncategorized']['CWE ID']))
    pcwe_df = df.loc[df['CWE Pillar ID'] != '']
    pcwes = Counter(list(pcwe_df['CWE Pillar ID']))
    print(f"[+] CWEs")
    print()
    print(f"Total CWE categories: {len(cwes)}")
    print()
    print(f"Number of uncategorized entries: {len(df.loc[df['CWE ID'] == 'CWE-Uncategorized'])}")
    print()
    print_most_common_cwes(cwes, 20)
    print_least_common_cwes(cwes, 10)
    print("Pillar CWE IDs:")
    print_most_common_cwes(pcwes, 10)
    print_least_common_cwes(pcwes, 5)


def print_most_common_cwes(cwe_data, quantity):
    """Prints the top quantity of specified CWEs"""
    print(f"Most common CWEs:")
    for cwe in cwe_data.most_common(quantity):
        print(f"{' '*10}{cwe[0]}: {cwe[1]}")


def print_least_common_cwes(cwe_data, quantity):
    """Prints the bottom quantity of specified CWEs"""
    print(f"Least common CWEs: ")
    q = int('-' + str(quantity))
    for cwe in cwe_data.most_common()[:q-1:-1]:
        print(f"{' '*10}{cwe[0]}: {cwe[1]}")


def get_most_and_least_common_cwe_by_risk_level(df, risk):
    """Prints the most and least common CWEs in the data frame."""
    riskname = 'INFORMATIONAL' if risk == '' else risk
    print(f"[*] {riskname}")
    print(f"Total items: {len(df.loc[df['CVSSv3 Base Severity'] == f'{risk}'])}")
    temp_df = df.loc[(df['CWE ID'] != 'CWE-Uncategorized') & (df['CWE ID'] != '')]
    uncat_df = df.loc[df['CWE ID'] == 'CWE-Uncategorized']
    blank_df = df.loc[df['CWE ID'] == '']
    pcwe_df = df.loc[df['CWE ID'] != '']['CWE Pillar ID']
    pcwes = Counter(list(temp_df.loc[temp_df['CVSSv3 Base Severity'] == f'{risk}']['CWE Pillar ID']))
    cwes = Counter(list(temp_df.loc[temp_df['CVSSv3 Base Severity'] == f'{risk}']['CWE ID']))
    print(f"Total CWE categories: {len(cwes)}")
    print(f"Number of uncategorized entries: {len(uncat_df.loc[uncat_df['CVSSv3 Base Severity'] == f'{risk}']) + len(blank_df.loc[blank_df['CVSSv3 Base Severity'] == f'{risk}'])}")
    print_most_common_cwes(cwes, 20)
    print_least_common_cwes(cwes, 10)
    print("Pillar CWE IDs:")
    print_most_common_cwes(pcwes, 10)
    print_least_common_cwes(pcwes, 5)


def get_metrics(df):
    """Prints some metrics from analyzing the data set"""
    print(f"Total issues: {len(df)}")
    print_risks_by_rating(df)
    get_most_and_least_common_cwe(df)
    print("[+] CWEs by Risk Rating")
    for risk in ['CRITICAL','HIGH','MEDIUM','LOW','']:
        get_most_and_least_common_cwe_by_risk_level(df, risk)


def main():
    print(f"[*] Reading file: {filename}")
    cve_data_dict = read_json_to_dict(filename)
    data_list = get_data_lists_from_dict(cve_data_dict)
    df = pd.DataFrame(data_list)
    df.columns = [
        'CVE ID',
        'CWE ID',
        'Description',
        'CVSSv3 Base Severity',
        'CVSSv3 Base Score',
        'CVSSv2 Base Severity',
        'CVSSv2 Base Score',
    ]
    cwe_dict = cwe_to_pillar()
    df['CWE Pillar ID'] = ''
    for item in cwe_dict:
        try:
            df.loc[df['CWE ID'] == str(item), 'CWE Pillar ID'] = cwe_dict.get(item)
        except Exception as e:
            input(e)
            pass
    if args.cwe:
        print(f"[*] Getting data for CWE {args.cwe}")
        get_cwe_risk_info(df, args.cwe)

    else:
        print(f"[*] Analyzing data...")
        get_metrics(df)    


if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "-c","--cwe", 
        help="Specify a CWE id (-c 79). The script will return metrics about risk data associated with that id."
    )
    parser.add_argument(
        "-f", "--file",
        help='Specify the path of a json file containing CVE data from https://nvd.nist.gov/vuln/data-feeds'
    )
    args = parser.parse_args()

    # Print banner
    print()
    word_banner = '{} version: {}. Coded by: {}'.format(sys.argv[0].title()[:-3], __version__, __author__)
    print('=' * len(word_banner))
    print(word_banner)
    print('=' * len(word_banner))
    print()
    time.sleep(1)

    if not args.file:
        print("[-] Specify the path of a json file (-f data.json) containing CVE data from https://nvd.nist.gov/vuln/data-feeds")
        exit()
    filename = args.file
    if not os.path.exists(filename):
        print("[-] The file cannot be found or you do not have permission to open the file. Please check the path and try again")
        exit()
    main()